@using Assignment_2.Models

@model IEnumerable<ItemSalesInfo>

@{
    ViewBag.Title = "Daily Summary";
}

<h2>@ViewBag.location Daily Summary</h2>
@{ 
if (@ViewBag.message) {
    <table border="1">

        <tr>
            <th>Item SKU</th>
            <th>Quantity Sold</th>
            <th>Total CP</th>
            <th>Total SP</th>
        </tr>

        @foreach (ItemSalesInfo i in Model)
        {
            <tr id="@i.name">
                <td>@i.name</td>
                <td>@i.quantitySold</td>
                <td>@i.foreverCP</td>
                <td>@i.foreverSP</td>
            </tr>
        }
    </table>
    }
    else
    {
        <p>Please specify a valid location in the URL /Home/DailySummary/<b>yourlocation</b> </p>
    }
}

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.

            chat.client.updateItemSales = function (location,sku,quantity, cp, sp) {
                //Update summary information.
                var l = "@ViewBag.location";
                if(location === l){
                    $("#" + sku).find("td").eq(0).text(sku);
                    $("#" + sku).find("td").eq(1).text(quantity);
                    $("#" + sku).find("td").eq(2).text(cp);
                    $("#" + sku).find("td").eq(3).text(sp);
                }
            };

            $.connection.hub.start().done(function () {

            });
        });
        
    </script>
}