@using Assignment_2.Models

@model IEnumerable<ItemInfo>

@{
    ViewBag.Title = "@ViewBag.location Inventory";
}

<h2>@ViewBag.location Inventory</h2>

@{ 
    if (ViewBag.message)
    {
        


        <table border="1">

            <tr>
                <th>Item Name</th>
                <th>SKU</th>
                <th>In Stock</th>
            </tr>

            @foreach (ItemInfo i in Model)
            {
                <tr id="@i.sku">
                    <td>@i.name</td>
                    <td>@i.sku</td>
                    <td>@i.quantity</td>
                </tr>
            }
        </table>
    }
    else
    {
        <p>Please specify a valid location in the URL /Home/Inventory/<b>yourlocation</b> </p>
    }
}

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.

            chat.client.updateItemStock = function (location,name,sku,quantity) {
                //Update summary information.
                var l = "@ViewBag.location";
                if (location === l) {
                    $("#" + sku).find("td").eq(0).text(name);
                    $("#" + sku).find("td").eq(1).text(sku);
                    $("#" + sku).find("td").eq(2).text(quantity);
                }
            };

            $.connection.hub.start().done(function () {

            });
        });

    </script>
}